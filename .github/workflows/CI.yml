name: Prepare Dummy Stuff

on:
  push:
    paths-ignore:
      - '*.md'
    branches: [ master ]

defaults:
  run:
    shell: bash

env:
  DUMP_URL: # Enter the git URL of your Dump
  
  # Set it to true if you want to do that:
  DOWNLOAD_BLOBS: false
  GEN_DT: true
  GEN_VT: true
  REBASE_KERNEL_TO_CAF: false
  MK_SYSTEM_VENDOR_PROP: true
  
jobs:
  run:
    runs-on: ubuntu-latest

    steps:
       - name: Checkouts
         uses: actions/checkout@v2
         
       - name: Configuring Git...
         run: |
              git config --global user.name "Sushrut1101"
              git config --global user.email "guptasushrut@gmail.com"
      
       - name: Storing git Secrets...
         run: |
              echo "${{ secrets.GIT_TOKEN }}" > ~/.github_token
              echo "${{ secrets.GIT_ORG_NAME }}" > ~/.github_orgname
   
       - name: Clone Dumps
         run: |
              echo "Cloning the Dumps to ~/dump ..."
              git clone --depth=1 $DUMP_URL ~/dump || { echo "Failed to Clone Dump" && exit 1; }
              echo "Dump Cloned Successfully!"

       - name: Clone android_tools
         run: |
              echo "Cloning android_tools to ~/android"
              git clone https://github.com/ShivamKumarJha/android_tools.git ~/android || { echo "ERROR: Failed to Clone android_tools" && exit 1; }
              echo "android_tools Successfullt Cloned!"              

       - name: Running "Device Tree Generator"...
         if: ${{ GEN_DT == true }}
         run: |
              echo "Generating Dummy DT..."
              cd ~/android
              ./tools/dummy_dt.sh ~/dump
              echo "Done!"
              echo "Pushing the Trees..."
              export BRAND=$(ls dummy_dt/)
              export DEVICE=$(ls dummp_dt/$BRAND/)
              cd dummp_dt/$BRAND/$DEVICE
              export TOKEN=$(cat ~/.github_token)
              export ORG=$(cat ~/.github_orgname)
              git remote remove origin
              git remote add origin https://github.com/$ORG/dummy_device_$BRAND_$DEVICE
              git push -u
              
